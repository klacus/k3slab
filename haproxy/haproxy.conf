#
# Automatically generated configuration.
# Do not edit this file manually.
#

global
    uid                         80
    gid                         80
    chroot                      /var/haproxy
    daemon
    stats                       socket /var/run/haproxy.socket group proxy mode 775 level admin
    nbthread                    1
    hard-stop-after             1s
    no strict-limits
    httpclient.resolvers.prefer   ipv4
    tune.ssl.default-dh-param   2048
    spread-checks               2
    tune.bufsize                16384
    tune.lua.maxmem             0
    log                         /var/run/log local0 debug
    lua-prepend-path            /tmp/haproxy/lua/?.lua

defaults
    log     global
    option redispatch -1
    timeout client 30s
    timeout connect 30s
    timeout server 30s
    retries 3
    default-server init-addr last,libc

# autogenerated entries for ACLs


# autogenerated entries for config in backends/frontends

# autogenerated entries for stats




# Frontend: K3sLabControlPlane ()
frontend K3sLabControlPlane
    bind lab-k3s.perihelion.lan:6443 name lab-k3s.perihelion.lan:6443 
    mode tcp
    default_backend K3sLabServers

    # logging options
    option tcplog

# Frontend: K3sLabServices ()
frontend K3sLabServices
    bind lab-k3s.perihelion.lan:80 name lab-k3s.perihelion.lan:80 
    bind lab-k3s.perihelion.lan:443 name lab-k3s.perihelion.lan:443 
    mode tcp
    default_backend K3sLabWorkers

    # logging options
    option tcplog

# Backend: K3sLabServers ()
backend K3sLabServers
    option log-health-checks
    # health check: Kubernetes Conntrol Plane
    # ERROR: invalid custom TCP health check, missing send/expect data
    mode tcp
    balance roundrobin

    server K3sLabM1 lab-k3sm1.perihelion.lan:6443 check inter 2s port 6443 
    server K3sLabM2 lab-k3sm2.perihelion.lan:6443 check inter 2s port 6443 
    server K3SLabM3 lab-k3sm3.perihelion.lan:6443 check inter 2s port 6443 

# Backend: K3sLabWorkers ()
backend K3sLabWorkers
    option log-health-checks
    # health check: Kubernetes Agents
    # ERROR: invalid custom TCP health check, missing send/expect data
    mode tcp
    balance roundrobin

    server K3sLabW1 lab-k3sw1.perihelion.lan check inter 2s port 10250 
    server K3sLabW2 lab-k3sw2.perihelion.lan check inter 2s port 10250 



listen local_statistics
    bind            127.0.0.1:8822
    mode            http
    stats uri       /haproxy?stats
    stats realm     HAProxy\ statistics
    stats admin     if TRUE

# remote statistics are DISABLED


